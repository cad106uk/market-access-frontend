{% from 'app-components/dashboard-heading.njk' import dashboardHeading %}
{% from 'app-components/collapsible.njk' import collapsible %}

{% extends 'layout.njk' %}

{% block page_title %}{{ super() }} - Homepage{% endblock %}

{% block body_script %}
	<script>
		ma.pages.index();
	</script>
{% endblock %}

{% macro tableHeading( text, field ) %}

	{%- if field -%}
		{% set text %}
			{% set isAsc = ( field.direction == 'asc' ) %}
			{%- if field.isActive -%}
				<a href="{{ field.url }}" title="Sort by {{ text }} {{ 'descending' if isAsc else 'ascending' }}" class="standard-table__heading__sorted-{{ 'ascending' if isAsc else 'descending' }}">{{ text }}</a>
			{%- else -%}
				<a href="{{ field.url }}" title="Sort by {{ text }} {{ 'ascending' if isAsc else 'descending' }}" class="standard-table__heading__sortable">{{ text }}</a>
			{%- endif -%}
		{% endset %}
	{%- endif -%}

	<th class="standard-table__heading{{ ' standard-table__heading--active' if field.isActive }}">{{ text | safe }}</th>
{% endmacro %}

{% block page_content %}

	{{ dashboardHeading( dashboard, isBarriers = true ) }}

	{%- if barriers and barriers.length -%}

		<div class="overflow-wrapper">
		<table class="standard-table standard-table--barriers">
			<thead>
				<tr class="standard-table__heading-row">
					{{ tableHeading( 'Priority', sortableFields.priority ) }}
					{{ tableHeading( 'Date added', sortableFields.date ) }}
					{{ tableHeading( 'Barrier title' ) }}
					{{ tableHeading( 'Sectors affected' ) }}
					{{ tableHeading( 'Barrier location', sortableFields.location ) }}
					{{ tableHeading( 'Status', sortableFields.status ) }}
				</tr>
			</thead>
			<tbody>
				{%- for barrier in barriers %}
				<tr class="standard-table__row">
					<td class="standard-table__cell"><span class="priority-marker priority-marker--{{ barrier.priority.modifyer }}"></span>{{ barrier.priority.name }}</td>
					<td class="standard-table__cell">{{ barrier.date.reported | dateOnly }}</td>
					<td class="standard-table__cell">
						<a class="dashboard-table__barrier-title" href="{{ urls.barriers.detail( barrier.id ) }}">
							{{ barrier.title }}
						</a>
						{{ barrier.code }}
					</td>
					<td class="standard-table__cell">
						{{ collapsible( barrier.sectors ) }}
					</td>
					<td class="standard-table__cell">{{ barrier.country.name }}</td>
					<td class="standard-table__cell"><span class="barrier-status-table-badge barrier-status-table-badge--{{ barrier.status.modifyer }}">{{ barrier.status.name }}</span></td>
				</tr>
				{%- endfor %}
			</tbody>
		</table>
		</div>

	{%- else -%}

		<p class="no-results-message">
			There are currently no market access barriers.
		</p>

	{%- endif %}
{% endblock %}
