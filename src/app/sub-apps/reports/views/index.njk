{% from 'app-components/dashboard-heading.njk' import dashboardHeading %}
{% from 'app-components/modal.njk' import modal %}
{% extends 'layout.njk' %}

{% block page_title %}{{ super() }} - Draft barriers{% endblock %}

{% block outsideContent %}
	{% if isDelete %}
		{% call modal(
				{ 
					'title': "Delete unfinished barrier", 
					'action': { 'url': urls.reports.delete( report.id ), 'text': "Yes, delete" },
					'cancel': { 'url': urls.reports.index(), 'text': "No, cancel" }
				}
			)
		%}
			<p> Are you sure you want to delete this unfinished barrier? </p>
			<dl class="inline-definition-list">
				<dt>Barrier ID </dt>
				<dd>{{ currentReport.code }}</dd>
				<dt>Location</dt>
				<dd>{{ currentReport.country.name }}</dd>
				{% if currentReport.barrier_title %}
					<dt>Barrier title</dt>
					<dd>{{ currentReport.barrier_title}}</dd>
				{% endif %}
				{% if currentReport.product %}
					<dt>Product or service</dt>
					<dd>{{ currentReport.product}}</dd>
				{% endif %}

			</dl>
		{% endcall %}
	{% endif %}
{% endblock %}
{% block page_content %}

	{{ dashboardHeading( dashboard, isReports = true ) }}

	{%- if reports.length -%}

		<table class="standard-table">
			<thead>
				<tr class="standard-table__heading-row">
					<th class="standard-table__heading standard-table__heading--active">Date started</th>
					<th class="standard-table__heading">Barrier ID</th>
					<th class="standard-table__heading">Barrier location</th>
					<th class="standard-table__heading">Resolved?</th>
					<th class="standard-table__heading">Barrier scope</th>
					<th class="standard-table__heading">Started by</th>
					<th class="standard-table__heading">Action</th>
				</tr>
			</thead>
			<tbody>
				{% for report in reports %}
				<tr class="standard-table__row">
					<td class="standard-table__cell">
						{{ ( report.date.created | dateWithTime ) or '---' }}
					</td>
					<td class="standard-table__cell">
						{{ report.code }}
					</td>
					<td class="standard-table__cell">
						{{ report.country.name or '---' }}
					</td>
					<td class="standard-table__cell">
						{{ 'Yes' if report.isResolved else 'No' }}
					</td>
					<td class="standard-table__cell">
						{{ report.problem_status.name or '---' }}
					</td>
					<td class="standard-table__cell">
						{{ report.created_by or '---' }}
					</td>
					<td class="standard-table__cell">
						<a class="table__link" href="{{ urls.reports.detail( report.id ) }}">Continue</a>
						{% if report.created_by === user.username %}
							<a class="table__link" href="{{ urls.reports.delete( report.id ) }}">Delete</a>
						{% endif %}
					</td>
				</tr>
				{% endfor %}
			</tbody>
		</table>

	{%- else -%}

		<p class="no-results-message">
			There are currently no draft market access barriers.
		</p>

	{%- endif %}
{% endblock %}
